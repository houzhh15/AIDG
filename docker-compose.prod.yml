# Docker Compose configuration for AIDG Production Deployment
# Uses published GHCR image with production-ready settings
#
# IMPORTANT: Before deploying to production:
# 1. Copy .env.example to .env
# 2. Update all secret values in .env
# 3. Never commit .env to version control
#
# Usage:
#   docker-compose -f docker-compose.prod.yml up -d
#   docker-compose -f docker-compose.prod.yml down
#   docker-compose -f docker-compose.prod.yml logs -f
#
# To use a specific version:
#   IMAGE_TAG=0.2.0 docker-compose -f docker-compose.prod.yml up -d

services:
  # Unified AIDG Service (Production)
  aidg:
    image: ghcr.io/houzhh15/aidg:${IMAGE_TAG:-latest}
    container_name: aidg-prod
    ports:
      - "8000:8000"  # Web Server
      - "8081:8081"  # MCP Server
    env_file:
      - .env  # Load all environment variables from .env file
    volumes:
      # Persistent data volumes
      - projects_data:/app/data/projects
      - users_data:/app/data/users
      - meetings_data:/app/data/meetings
      - audit_logs_data:/app/data/audit_logs
    networks:
      - aidg-network
    healthcheck:
      test: ["CMD", "sh", "-c", "wget --no-verbose --tries=1 --spider http://localhost:8000/health && wget --no-verbose --tries=1 --spider http://localhost:8081/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 20s
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M
    restart: always

networks:
  aidg-network:
    driver: bridge

volumes:
  projects_data:
    driver: local
  users_data:
    driver: local
  meetings_data:
    driver: local
  audit_logs_data:
    driver: local
