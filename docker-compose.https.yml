# Docker Compose HTTPS override configuration
# Use this file to enable HTTPS mode
#
# Usage:
#   1. Generate certificates:
#      ./scripts/generate-self-signed-cert.sh
#
#   2. Start with HTTPS:
#      docker-compose -f docker-compose.ghcr.yml -f docker-compose.https.yml up -d
#
#   3. For production with custom certificates:
#      Update the volume mounts below to point to your certificate files
#
# Note: This file overrides the base docker-compose.ghcr.yml configuration

services:
  aidg:
    ports:
      # HTTPS port (443 for standard HTTPS, or 8443 for non-privileged)
      - "443:443"
      # MCP Server port (unchanged)
      - "8081:8081"
    environment:
      # Enable HTTPS mode
      - SERVER_PROTOCOL=https
      - PORT=443
      # TLS certificate paths inside container
      - TLS_CERT_FILE=/app/certs/server.crt
      - TLS_KEY_FILE=/app/certs/server.key
      # Other settings
      - ENV=production
      - LOG_LEVEL=info
      - LOG_FORMAT=json
    volumes:
      # Data directories (inherited from base)
      - ./data/projects:/app/data/projects
      - ./data/users:/app/data/users
      - ./data/meetings:/app/data/meetings
      - ./data/audit_logs:/app/data/audit_logs
      # TLS certificates (read-only for security)
      - ./certs/server.crt:/app/certs/server.crt:ro
      - ./certs/server.key:/app/certs/server.key:ro
    healthcheck:
      # Update healthcheck to use HTTPS
      test: ["CMD", "sh", "-c", "wget --no-verbose --tries=1 --spider --no-check-certificate https://localhost:443/health && wget --no-verbose --tries=1 --spider http://localhost:8081/health"]
      interval: 30s
      timeout: 5s
      retries: 3
